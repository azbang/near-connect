var Xo=Object.defineProperty;var Wo=(ft,st,_t)=>st in ft?Xo(ft,st,{enumerable:!0,configurable:!0,writable:!0,value:_t}):ft[st]=_t;var d=(ft,st,_t)=>Wo(ft,typeof st!="symbol"?st+"":st,_t);(function(){"use strict";var Ot;var ft=["u8","u16","u32","u64","u128","i8","i16","i32","i64","i128","f32","f64"],st=function(){function t(){this.offset=0,this.buffer_size=256,this.buffer=new ArrayBuffer(this.buffer_size),this.view=new DataView(this.buffer)}return t.prototype.resize_if_necessary=function(e){if(this.buffer_size-this.offset<e){this.buffer_size=Math.max(this.buffer_size*2,this.buffer_size+e);var n=new ArrayBuffer(this.buffer_size);new Uint8Array(n).set(new Uint8Array(this.buffer)),this.buffer=n,this.view=new DataView(n)}},t.prototype.get_used_buffer=function(){return new Uint8Array(this.buffer).slice(0,this.offset)},t.prototype.store_value=function(e,n){var r=n.substring(1),o=parseInt(r)/8;this.resize_if_necessary(o);var s=n[0]==="f"?"setFloat".concat(r):n[0]==="i"?"setInt".concat(r):"setUint".concat(r);this.view[s](this.offset,e,!0),this.offset+=o},t.prototype.store_bytes=function(e){this.resize_if_necessary(e.length),new Uint8Array(this.buffer).set(new Uint8Array(e),this.offset),this.offset+=e.length},t}(),_t=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();function Zn(t){return Array.isArray(t)||!!t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&(t.length===0||t.length>0&&t.length-1 in t)}function St(t,e,n){if(typeof t!==e)throw new Error("Expected ".concat(e," not ").concat(typeof t,"(").concat(t,") at ").concat(n.join(".")))}function Jn(t,e){var n=["number","string","bigint","boolean"].includes(typeof t),r=typeof t=="object"&&t!==null&&"toString"in t;if(!n&&!r)throw new Error("Expected bigint, number, boolean or string not ".concat(typeof t,"(").concat(t,") at ").concat(e.join(".")))}function Ie(t,e,n){if(t!==e)throw new Error("Array length ".concat(t," does not match schema length ").concat(e," at ").concat(n.join(".")))}function Vn(t,e){if(typeof t!="object"||t===null)throw new Error("Expected object not ".concat(typeof t,"(").concat(t,") at ").concat(e.join(".")))}var Be=ft.concat(["bool","string"]),Te=["option","enum","array","set","map","struct"],It=function(t){_t(e,t);function e(n,r){var o="Invalid schema: ".concat(JSON.stringify(n)," expected ").concat(r);return t.call(this,o)||this}return e}(Error);function ut(t){if(!(typeof t=="string"&&Be.includes(t))){if(t&&typeof t=="object"){var e=Object.keys(t);if(e.length===1&&Te.includes(e[0])){var n=e[0];if(n==="option")return ut(t[n]);if(n==="enum")return Yn(t[n]);if(n==="array")return Gn(t[n]);if(n==="set")return ut(t[n]);if(n==="map")return Xn(t[n]);if(n==="struct")return Wn(t[n])}}throw new It(t,Te.join(", ")+" or "+Be.join(", "))}}function Yn(t){if(!Array.isArray(t))throw new It(t,"Array");for(var e=0,n=t;e<n.length;e++){var r=n[e];if(typeof r!="object"||!("struct"in r))throw new Error('Missing "struct" key in enum schema');if(typeof r.struct!="object"||Object.keys(r.struct).length!==1)throw new Error('The "struct" in each enum must have a single key');ut({struct:r.struct})}}function Gn(t){if(typeof t!="object")throw new It(t,"{ type, len? }");if(t.len&&typeof t.len!="number")throw new Error("Invalid schema: ".concat(t));if("type"in t)return ut(t.type);throw new It(t,"{ type, len? }")}function Xn(t){if(typeof t=="object"&&"key"in t&&"value"in t)ut(t.key),ut(t.value);else throw new It(t,"{ key, value }")}function Wn(t){if(typeof t!="object")throw new It(t,"object");for(var e in t)ut(t[e])}var Qn=function(){function t(e){this.encoded=new st,this.fieldPath=["value"],this.checkTypes=e}return t.prototype.encode=function(e,n){return this.encode_value(e,n),this.encoded.get_used_buffer()},t.prototype.encode_value=function(e,n){if(typeof n=="string"){if(ft.includes(n))return this.encode_integer(e,n);if(n==="string")return this.encode_string(e);if(n==="bool")return this.encode_boolean(e)}if(typeof n=="object"){if("option"in n)return this.encode_option(e,n);if("enum"in n)return this.encode_enum(e,n);if("array"in n)return this.encode_array(e,n);if("set"in n)return this.encode_set(e,n);if("map"in n)return this.encode_map(e,n);if("struct"in n)return this.encode_struct(e,n)}},t.prototype.encode_integer=function(e,n){var r=parseInt(n.substring(1));r<=32||n=="f64"?(this.checkTypes&&St(e,"number",this.fieldPath),this.encoded.store_value(e,n)):(this.checkTypes&&Jn(e,this.fieldPath),this.encode_bigint(BigInt(e),r))},t.prototype.encode_bigint=function(e,n){for(var r=n/8,o=new Uint8Array(r),s=0;s<r;s++)o[s]=Number(e&BigInt(255)),e=e>>BigInt(8);this.encoded.store_bytes(new Uint8Array(o))},t.prototype.encode_string=function(e){this.checkTypes&&St(e,"string",this.fieldPath);for(var n=e,r=[],o=0;o<n.length;o++){var s=n.charCodeAt(o);s<128?r.push(s):s<2048?r.push(192|s>>6,128|s&63):s<55296||s>=57344?r.push(224|s>>12,128|s>>6&63,128|s&63):(o++,s=65536+((s&1023)<<10|n.charCodeAt(o)&1023),r.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63))}this.encoded.store_value(r.length,"u32"),this.encoded.store_bytes(new Uint8Array(r))},t.prototype.encode_boolean=function(e){this.checkTypes&&St(e,"boolean",this.fieldPath),this.encoded.store_value(e?1:0,"u8")},t.prototype.encode_option=function(e,n){e==null?this.encoded.store_value(0,"u8"):(this.encoded.store_value(1,"u8"),this.encode_value(e,n.option))},t.prototype.encode_enum=function(e,n){this.checkTypes&&Vn(e,this.fieldPath);for(var r=Object.keys(e)[0],o=0;o<n.enum.length;o++){var s=n.enum[o];if(r===Object.keys(s.struct)[0])return this.encoded.store_value(o,"u8"),this.encode_struct(e,s)}throw new Error("Enum key (".concat(r,") not found in enum schema: ").concat(JSON.stringify(n)," at ").concat(this.fieldPath.join(".")))},t.prototype.encode_array=function(e,n){if(Zn(e))return this.encode_arraylike(e,n);if(e instanceof ArrayBuffer)return this.encode_buffer(e,n);throw new Error("Expected Array-like not ".concat(typeof e,"(").concat(e,") at ").concat(this.fieldPath.join(".")))},t.prototype.encode_arraylike=function(e,n){n.array.len?Ie(e.length,n.array.len,this.fieldPath):this.encoded.store_value(e.length,"u32");for(var r=0;r<e.length;r++)this.encode_value(e[r],n.array.type)},t.prototype.encode_buffer=function(e,n){n.array.len?Ie(e.byteLength,n.array.len,this.fieldPath):this.encoded.store_value(e.byteLength,"u32"),this.encoded.store_bytes(new Uint8Array(e))},t.prototype.encode_set=function(e,n){this.checkTypes&&St(e,"object",this.fieldPath);var r=e instanceof Set,o=r?Array.from(e.values()):Object.values(e);this.encoded.store_value(o.length,"u32");for(var s=0,a=o;s<a.length;s++){var c=a[s];this.encode_value(c,n.set)}},t.prototype.encode_map=function(e,n){this.checkTypes&&St(e,"object",this.fieldPath);var r=e instanceof Map,o=r?Array.from(e.keys()):Object.keys(e);this.encoded.store_value(o.length,"u32");for(var s=0,a=o;s<a.length;s++){var c=a[s];this.encode_value(c,n.map.key),this.encode_value(r?e.get(c):e[c],n.map.value)}},t.prototype.encode_struct=function(e,n){this.checkTypes&&St(e,"object",this.fieldPath);for(var r=0,o=Object.keys(n.struct);r<o.length;r++){var s=o[r];this.fieldPath.push(s),this.encode_value(e[s],n.struct[s]),this.fieldPath.pop()}},t}();function Pt(t,e,n){n===void 0&&(n=!0),n&&ut(t);var r=new Qn(n);return r.encode(e,t)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ce(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function se(t,e=""){if(!Number.isSafeInteger(t)||t<0){const n=e&&`"${e}" `;throw new Error(`${n}expected integer >= 0, got ${t}`)}}function $(t,e,n=""){const r=Ce(t),o=t==null?void 0:t.length,s=e!==void 0;if(!r||s&&o!==e){const a=n&&`"${n}" `,c=s?` of length ${e}`:"",i=r?`length=${o}`:`type=${typeof t}`;throw new Error(a+"expected Uint8Array"+c+", got "+i)}return t}function Ke(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function tr(t,e){$(t,void 0,"digestInto() output");const n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function kt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function ie(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Q(t,e){return t<<32-e|t>>>e}const Re=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",er=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ce(t){if($(t),Re)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=er[t[n]];return e}const it={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ne(t){if(t>=it._0&&t<=it._9)return t-it._0;if(t>=it.A&&t<=it.F)return t-(it.A-10);if(t>=it.a&&t<=it.f)return t-(it.a-10)}function Ue(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Re)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){const a=Ne(t.charCodeAt(s)),c=Ne(t.charCodeAt(s+1));if(a===void 0||c===void 0){const i=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+i+'" at index '+s)}r[o]=a*16+c}return r}function Oe(...t){let e=0;for(let r=0;r<t.length;r++){const o=t[r];$(o),e+=o.length}const n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){const s=t[r];n.set(s,o),o+=s.length}return n}function Pe(t,e={}){const n=(o,s)=>t(s).update(o).digest(),r=t(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=o=>t(o),Object.assign(n,e),Object.freeze(n)}function nr(t=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof(e==null?void 0:e.getRandomValues)!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}const ke=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});function rr(t,e,n){return t&e^~t&n}function or(t,e,n){return t&e^t&n^e&n}class De{constructor(e,n,r,o){d(this,"blockLen");d(this,"outputLen");d(this,"padOffset");d(this,"isLE");d(this,"buffer");d(this,"view");d(this,"finished",!1);d(this,"length",0);d(this,"pos",0);d(this,"destroyed",!1);this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(e),this.view=ie(this.buffer)}update(e){Ke(this),$(e);const{view:n,buffer:r,blockLen:o}=this,s=e.length;for(let a=0;a<s;){const c=Math.min(o-this.pos,s-a);if(c===o){const i=ie(e);for(;o<=s-a;a+=o)this.process(i,a);continue}r.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ke(this),tr(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:a}=this;n[a++]=128,kt(this.buffer.subarray(a)),this.padOffset>o-a&&(this.process(r,0),a=0);for(let u=a;u<o;u++)n[u]=0;r.setBigUint64(o-8,BigInt(this.length*8),s),this.process(r,0);const c=ie(e),i=this.outputLen;if(i%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const f=i/4,w=this.get();if(f>w.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,w[u],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:a,pos:c}=this;return e.destroyed=a,e.finished=s,e.length=o,e.pos=c,o%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const lt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),z=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),zt=BigInt(2**32-1),qe=BigInt(32);function sr(t,e=!1){return e?{h:Number(t&zt),l:Number(t>>qe&zt)}:{h:Number(t>>qe&zt)|0,l:Number(t&zt)|0}}function ir(t,e=!1){const n=t.length;let r=new Uint32Array(n),o=new Uint32Array(n);for(let s=0;s<n;s++){const{h:a,l:c}=sr(t[s],e);[r[s],o[s]]=[a,c]}return[r,o]}const Le=(t,e,n)=>t>>>n,je=(t,e,n)=>t<<32-n|e>>>n,Bt=(t,e,n)=>t>>>n|e<<32-n,Tt=(t,e,n)=>t<<32-n|e>>>n,Zt=(t,e,n)=>t<<64-n|e>>>n-32,Jt=(t,e,n)=>t>>>n-32|e<<64-n;function ct(t,e,n,r){const o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:o|0}}const cr=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),ar=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,fr=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),ur=(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0,lr=(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0),dr=(t,e,n,r,o,s)=>e+n+r+o+s+(t/2**32|0)|0,hr=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),dt=new Uint32Array(64);class pr extends De{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:n,C:r,D:o,E:s,F:a,G:c,H:i}=this;return[e,n,r,o,s,a,c,i]}set(e,n,r,o,s,a,c,i){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=c|0,this.H=i|0}process(e,n){for(let u=0;u<16;u++,n+=4)dt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const E=dt[u-15],K=dt[u-2],R=Q(E,7)^Q(E,18)^E>>>3,B=Q(K,17)^Q(K,19)^K>>>10;dt[u]=B+dt[u-7]+R+dt[u-16]|0}let{A:r,B:o,C:s,D:a,E:c,F:i,G:f,H:w}=this;for(let u=0;u<64;u++){const E=Q(c,6)^Q(c,11)^Q(c,25),K=w+E+rr(c,i,f)+hr[u]+dt[u]|0,B=(Q(r,2)^Q(r,13)^Q(r,22))+or(r,o,s)|0;w=f,f=i,i=c,c=a+K|0,a=s,s=o,o=r,r=K+B|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,c=c+this.E|0,i=i+this.F|0,f=f+this.G|0,w=w+this.H|0,this.set(r,o,s,a,c,i,f,w)}roundClean(){kt(dt)}destroy(){this.set(0,0,0,0,0,0,0,0),kt(this.buffer)}}class gr extends pr{constructor(){super(32);d(this,"A",lt[0]|0);d(this,"B",lt[1]|0);d(this,"C",lt[2]|0);d(this,"D",lt[3]|0);d(this,"E",lt[4]|0);d(this,"F",lt[5]|0);d(this,"G",lt[6]|0);d(this,"H",lt[7]|0)}}const Me=ir(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),yr=Me[0],wr=Me[1],ht=new Uint32Array(80),pt=new Uint32Array(80);class br extends De{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:n,Bh:r,Bl:o,Ch:s,Cl:a,Dh:c,Dl:i,Eh:f,El:w,Fh:u,Fl:E,Gh:K,Gl:R,Hh:B,Hl:A}=this;return[e,n,r,o,s,a,c,i,f,w,u,E,K,R,B,A]}set(e,n,r,o,s,a,c,i,f,w,u,E,K,R,B,A){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=o|0,this.Ch=s|0,this.Cl=a|0,this.Dh=c|0,this.Dl=i|0,this.Eh=f|0,this.El=w|0,this.Fh=u|0,this.Fl=E|0,this.Gh=K|0,this.Gl=R|0,this.Hh=B|0,this.Hl=A|0}process(e,n){for(let y=0;y<16;y++,n+=4)ht[y]=e.getUint32(n),pt[y]=e.getUint32(n+=4);for(let y=16;y<80;y++){const S=ht[y-15]|0,U=pt[y-15]|0,L=Bt(S,U,1)^Bt(S,U,8)^Le(S,U,7),D=Tt(S,U,1)^Tt(S,U,8)^je(S,U,7),x=ht[y-2]|0,b=pt[y-2]|0,I=Bt(x,b,19)^Zt(x,b,61)^Le(x,b,6),O=Tt(x,b,19)^Jt(x,b,61)^je(x,b,6),h=fr(D,O,pt[y-7],pt[y-16]),l=ur(h,L,I,ht[y-7],ht[y-16]);ht[y]=l|0,pt[y]=h|0}let{Ah:r,Al:o,Bh:s,Bl:a,Ch:c,Cl:i,Dh:f,Dl:w,Eh:u,El:E,Fh:K,Fl:R,Gh:B,Gl:A,Hh:N,Hl:m}=this;for(let y=0;y<80;y++){const S=Bt(u,E,14)^Bt(u,E,18)^Zt(u,E,41),U=Tt(u,E,14)^Tt(u,E,18)^Jt(u,E,41),L=u&K^~u&B,D=E&R^~E&A,x=lr(m,U,D,wr[y],pt[y]),b=dr(x,N,S,L,yr[y],ht[y]),I=x|0,O=Bt(r,o,28)^Zt(r,o,34)^Zt(r,o,39),h=Tt(r,o,28)^Jt(r,o,34)^Jt(r,o,39),l=r&s^r&c^s&c,g=o&a^o&i^a&i;N=B|0,m=A|0,B=K|0,A=R|0,K=u|0,R=E|0,{h:u,l:E}=ct(f|0,w|0,b|0,I|0),f=c|0,w=i|0,c=s|0,i=a|0,s=r|0,a=o|0;const p=cr(I,h,g);r=ar(p,b,O,l),o=p|0}({h:r,l:o}=ct(this.Ah|0,this.Al|0,r|0,o|0)),{h:s,l:a}=ct(this.Bh|0,this.Bl|0,s|0,a|0),{h:c,l:i}=ct(this.Ch|0,this.Cl|0,c|0,i|0),{h:f,l:w}=ct(this.Dh|0,this.Dl|0,f|0,w|0),{h:u,l:E}=ct(this.Eh|0,this.El|0,u|0,E|0),{h:K,l:R}=ct(this.Fh|0,this.Fl|0,K|0,R|0),{h:B,l:A}=ct(this.Gh|0,this.Gl|0,B|0,A|0),{h:N,l:m}=ct(this.Hh|0,this.Hl|0,N|0,m|0),this.set(r,o,s,a,c,i,f,w,u,E,K,R,B,A,N,m)}roundClean(){kt(ht,pt)}destroy(){kt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class xr extends br{constructor(){super(64);d(this,"Ah",z[0]|0);d(this,"Al",z[1]|0);d(this,"Bh",z[2]|0);d(this,"Bl",z[3]|0);d(this,"Ch",z[4]|0);d(this,"Cl",z[5]|0);d(this,"Dh",z[6]|0);d(this,"Dl",z[7]|0);d(this,"Eh",z[8]|0);d(this,"El",z[9]|0);d(this,"Fh",z[10]|0);d(this,"Fl",z[11]|0);d(this,"Gh",z[12]|0);d(this,"Gl",z[13]|0);d(this,"Hh",z[14]|0);d(this,"Hl",z[15]|0)}}const He=Pe(()=>new gr,ke(1)),mr=Pe(()=>new xr,ke(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $e=BigInt(0),Fe=BigInt(1);function ae(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}" `;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function vr(t){if(typeof t=="bigint"){if(!Yt(t))throw new Error("positive bigint expected, got "+t)}else se(t);return t}function ze(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?$e:BigInt("0x"+t)}function Er(t){return ze(ce(t))}function Vt(t){return ze(ce(fe($(t)).reverse()))}function Ze(t,e){se(e),t=vr(t);const n=Ue(t.toString(16).padStart(e*2,"0"));if(n.length!==e)throw new Error("number too large");return n}function Ar(t,e){return Ze(t,e).reverse()}function fe(t){return Uint8Array.from(t)}const Yt=t=>typeof t=="bigint"&&$e<=t;function _r(t,e,n){return Yt(t)&&Yt(e)&&Yt(n)&&e<=t&&t<n}function Je(t,e,n,r){if(!_r(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}const Sr=t=>(Fe<<BigInt(t))-Fe;function ue(t,e={},n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(s,a,c){const i=t[s];if(c&&i===void 0)return;const f=typeof i;if(f!==a||i===null)throw new Error(`param "${s}" is invalid: expected ${a}, got ${f}`)}const o=(s,a)=>Object.entries(s).forEach(([c,i])=>r(c,i,a));o(e,!1),o(n,!0)}function Ve(t){const e=new WeakMap;return(n,...r)=>{const o=e.get(n);if(o!==void 0)return o;const s=t(n,...r);return e.set(n,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const J=BigInt(0),Z=BigInt(1),wt=BigInt(2),Ye=BigInt(3),Ge=BigInt(4),Xe=BigInt(5),Ir=BigInt(7),We=BigInt(8),Br=BigInt(9),Qe=BigInt(16);function j(t,e){const n=t%e;return n>=J?n:e+n}function tt(t,e,n){let r=t;for(;e-- >J;)r*=r,r%=n;return r}function tn(t,e){if(t===J)throw new Error("invert: expected non-zero number");if(e<=J)throw new Error("invert: expected positive modulus, got "+e);let n=j(t,e),r=e,o=J,s=Z;for(;n!==J;){const c=r/n,i=r%n,f=o-s*c;r=n,n=i,o=s,s=f}if(r!==Z)throw new Error("invert: does not exist");return j(o,e)}function le(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function en(t,e){const n=(t.ORDER+Z)/Ge,r=t.pow(e,n);return le(t,r,e),r}function Tr(t,e){const n=(t.ORDER-Xe)/We,r=t.mul(e,wt),o=t.pow(r,n),s=t.mul(e,o),a=t.mul(t.mul(s,wt),o),c=t.mul(s,t.sub(a,t.ONE));return le(t,c,e),c}function Cr(t){const e=de(t),n=nn(t),r=n(e,e.neg(e.ONE)),o=n(e,r),s=n(e,e.neg(r)),a=(t+Ir)/Qe;return(c,i)=>{let f=c.pow(i,a),w=c.mul(f,r);const u=c.mul(f,o),E=c.mul(f,s),K=c.eql(c.sqr(w),i),R=c.eql(c.sqr(u),i);f=c.cmov(f,w,K),w=c.cmov(E,u,R);const B=c.eql(c.sqr(w),i),A=c.cmov(f,w,B);return le(c,A,i),A}}function nn(t){if(t<Ye)throw new Error("sqrt is not defined for small field");let e=t-Z,n=0;for(;e%wt===J;)e/=wt,n++;let r=wt;const o=de(t);for(;on(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return en;let s=o.pow(r,e);const a=(e+Z)/wt;return function(i,f){if(i.is0(f))return f;if(on(i,f)!==1)throw new Error("Cannot find square root");let w=n,u=i.mul(i.ONE,s),E=i.pow(f,e),K=i.pow(f,a);for(;!i.eql(E,i.ONE);){if(i.is0(E))return i.ZERO;let R=1,B=i.sqr(E);for(;!i.eql(B,i.ONE);)if(R++,B=i.sqr(B),R===w)throw new Error("Cannot find square root");const A=Z<<BigInt(w-R-1),N=i.pow(u,A);w=R,u=i.sqr(N),E=i.mul(E,u),K=i.mul(K,N)}return K}}function Kr(t){return t%Ge===Ye?en:t%We===Xe?Tr:t%Qe===Br?Cr(t):nn(t)}const Rr=(t,e)=>(j(t,e)&Z)===Z,Nr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ur(t){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},n=Nr.reduce((r,o)=>(r[o]="function",r),e);return ue(t,n),t}function Or(t,e,n){if(n<J)throw new Error("invalid exponent, negatives unsupported");if(n===J)return t.ONE;if(n===Z)return e;let r=t.ONE,o=e;for(;n>J;)n&Z&&(r=t.mul(r,o)),o=t.sqr(o),n>>=Z;return r}function rn(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),o=e.reduce((a,c,i)=>t.is0(c)?a:(r[i]=a,t.mul(a,c)),t.ONE),s=t.inv(o);return e.reduceRight((a,c,i)=>t.is0(c)?a:(r[i]=t.mul(a,r[i]),t.mul(a,c)),s),r}function on(t,e){const n=(t.ORDER-Z)/wt,r=t.pow(e,n),o=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),a=t.eql(r,t.neg(t.ONE));if(!o&&!s&&!a)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Pr(t,e){e!==void 0&&se(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}class kr{constructor(e,n={}){d(this,"ORDER");d(this,"BITS");d(this,"BYTES");d(this,"isLE");d(this,"ZERO",J);d(this,"ONE",Z);d(this,"_lengths");d(this,"_sqrt");d(this,"_mod");var a;if(e<=J)throw new Error("invalid field: expected ORDER > 0, got "+e);let r;this.isLE=!1,n!=null&&typeof n=="object"&&(typeof n.BITS=="number"&&(r=n.BITS),typeof n.sqrt=="function"&&(this.sqrt=n.sqrt),typeof n.isLE=="boolean"&&(this.isLE=n.isLE),n.allowedLengths&&(this._lengths=(a=n.allowedLengths)==null?void 0:a.slice()),typeof n.modFromBytes=="boolean"&&(this._mod=n.modFromBytes));const{nBitLength:o,nByteLength:s}=Pr(e,r);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return j(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return J<=e&&e<this.ORDER}is0(e){return e===J}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&Z)===Z}neg(e){return j(-e,this.ORDER)}eql(e,n){return e===n}sqr(e){return j(e*e,this.ORDER)}add(e,n){return j(e+n,this.ORDER)}sub(e,n){return j(e-n,this.ORDER)}mul(e,n){return j(e*n,this.ORDER)}pow(e,n){return Or(this,e,n)}div(e,n){return j(e*tn(n,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,n){return e+n}subN(e,n){return e-n}mulN(e,n){return e*n}inv(e){return tn(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=Kr(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?Ar(e,this.BYTES):Ze(e,this.BYTES)}fromBytes(e,n=!1){$(e);const{_lengths:r,BYTES:o,isLE:s,ORDER:a,_mod:c}=this;if(r){if(!r.includes(e.length)||e.length>o)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+e.length);const f=new Uint8Array(o);f.set(e,s?0:f.length-e.length),e=f}if(e.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+e.length);let i=s?Vt(e):Er(e);if(c&&(i=j(i,a)),!n&&!this.isValid(i))throw new Error("invalid field element: outside of range 0..ORDER");return i}invertBatch(e){return rn(this,e)}cmov(e,n,r){return r?n:e}}function de(t,e={}){return new kr(t,e)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gt=BigInt(0),he=BigInt(1);function sn(t,e){const n=e.negate();return t?n:e}function pe(t,e){const n=rn(t.Fp,e.map(r=>r.Z));return e.map((r,o)=>t.fromAffine(r.toAffine(n[o])))}function cn(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ge(t,e){cn(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),o=2**t,s=Sr(t),a=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:a}}function an(t,e,n){const{windowSize:r,mask:o,maxNumber:s,shiftBy:a}=n;let c=Number(t&o),i=t>>a;c>r&&(c-=s,i+=he);const f=e*r,w=f+Math.abs(c)-1,u=c===0,E=c<0,K=e%2!==0;return{nextN:i,offset:w,isZero:u,isNeg:E,isNegF:K,offsetF:f}}const ye=new WeakMap,fn=new WeakMap;function we(t){return fn.get(t)||1}function un(t){if(t!==Gt)throw new Error("invalid wNAF")}class Dr{constructor(e,n){d(this,"BASE");d(this,"ZERO");d(this,"Fn");d(this,"bits");this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let o=e;for(;n>Gt;)n&he&&(r=r.add(o)),o=o.double(),n>>=he;return r}precomputeWindow(e,n){const{windows:r,windowSize:o}=ge(n,this.bits),s=[];let a=e,c=a;for(let i=0;i<r;i++){c=a,s.push(c);for(let f=1;f<o;f++)c=c.add(a),s.push(c);a=c.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE;const a=ge(e,this.bits);for(let c=0;c<a.windows;c++){const{nextN:i,offset:f,isZero:w,isNeg:u,isNegF:E,offsetF:K}=an(r,c,a);r=i,w?s=s.add(sn(E,n[K])):o=o.add(sn(u,n[f]))}return un(r),{p:o,f:s}}wNAFUnsafe(e,n,r,o=this.ZERO){const s=ge(e,this.bits);for(let a=0;a<s.windows&&r!==Gt;a++){const{nextN:c,offset:i,isZero:f,isNeg:w}=an(r,a,s);if(r=c,!f){const u=n[i];o=o.add(w?u.negate():u)}}return un(r),o}getPrecomputes(e,n,r){let o=ye.get(n);return o||(o=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(o=r(o)),ye.set(n,o))),o}cached(e,n,r){const o=we(e);return this.wNAF(o,this.getPrecomputes(o,e,r),n)}unsafe(e,n,r,o){const s=we(e);return s===1?this._unsafeLadder(e,n,o):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,o)}createCache(e,n){cn(n,this.bits),fn.set(e,n),ye.delete(e)}hasCache(e){return we(e)!==1}}function ln(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Ur(e),e}else return de(t,{isLE:n})}function qr(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const i of["p","n","h"]){const f=e[i];if(!(typeof f=="bigint"&&f>Gt))throw new Error(`CURVE.${i} must be positive bigint`)}const o=ln(e.p,n.Fp,r),s=ln(e.n,n.Fn,r),c=["Gx","Gy","a","d"];for(const i of c)if(!o.isValid(e[i]))throw new Error(`CURVE.${i} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:s}}function Lr(t,e){return function(r){const o=t(r);return{secretKey:o,publicKey:e(o)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gt=BigInt(0),M=BigInt(1),be=BigInt(2),jr=BigInt(8);function Mr(t,e,n,r){const o=t.sqr(n),s=t.sqr(r),a=t.add(t.mul(e.a,o),s),c=t.add(t.ONE,t.mul(e.d,t.mul(o,s)));return t.eql(a,c)}function Hr(t,e={}){const n=qr("edwards",t,e,e.FpFnLE),{Fp:r,Fn:o}=n;let s=n.CURVE;const{h:a}=s;ue(e,{},{uvRatio:"function"});const c=be<<BigInt(o.BYTES*8)-M,i=N=>r.create(N),f=e.uvRatio||((N,m)=>{try{return{isValid:!0,value:r.sqrt(r.div(N,m))}}catch{return{isValid:!1,value:gt}}});if(!Mr(r,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function w(N,m,y=!1){const S=y?M:gt;return Je("coordinate "+N,m,S,c),m}function u(N){if(!(N instanceof R))throw new Error("EdwardsPoint expected")}const E=Ve((N,m)=>{const{X:y,Y:S,Z:U}=N,L=N.is0();m==null&&(m=L?jr:r.inv(U));const D=i(y*m),x=i(S*m),b=r.mul(U,m);if(L)return{x:gt,y:M};if(b!==M)throw new Error("invZ was invalid");return{x:D,y:x}}),K=Ve(N=>{const{a:m,d:y}=s;if(N.is0())throw new Error("bad point: ZERO");const{X:S,Y:U,Z:L,T:D}=N,x=i(S*S),b=i(U*U),I=i(L*L),O=i(I*I),h=i(x*m),l=i(I*i(h+b)),g=i(O+i(y*i(x*b)));if(l!==g)throw new Error("bad point: equation left != right (1)");const p=i(S*U),v=i(L*D);if(p!==v)throw new Error("bad point: equation left != right (2)");return!0}),A=class A{constructor(m,y,S,U){d(this,"X");d(this,"Y");d(this,"Z");d(this,"T");this.X=w("x",m),this.Y=w("y",y),this.Z=w("z",S,!0),this.T=w("t",U),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){if(m instanceof A)throw new Error("extended point not allowed");const{x:y,y:S}=m||{};return w("x",y),w("y",S),new A(y,S,M,i(y*S))}static fromBytes(m,y=!1){const S=r.BYTES,{a:U,d:L}=s;m=fe($(m,S,"point")),ae(y,"zip215");const D=fe(m),x=m[S-1];D[S-1]=x&-129;const b=Vt(D),I=y?c:r.ORDER;Je("point.y",b,gt,I);const O=i(b*b),h=i(O-M),l=i(L*O-U);let{isValid:g,value:p}=f(h,l);if(!g)throw new Error("bad point: invalid y coordinate");const v=(p&M)===M,_=(x&128)!==0;if(!y&&p===gt&&_)throw new Error("bad point: x=0 and x_0=1");return _!==v&&(p=i(-p)),A.fromAffine({x:p,y:b})}static fromHex(m,y=!1){return A.fromBytes(Ue(m),y)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,y=!0){return B.createCache(this,m),y||this.multiply(be),this}assertValidity(){K(this)}equals(m){u(m);const{X:y,Y:S,Z:U}=this,{X:L,Y:D,Z:x}=m,b=i(y*x),I=i(L*U),O=i(S*x),h=i(D*U);return b===I&&O===h}is0(){return this.equals(A.ZERO)}negate(){return new A(i(-this.X),this.Y,this.Z,i(-this.T))}double(){const{a:m}=s,{X:y,Y:S,Z:U}=this,L=i(y*y),D=i(S*S),x=i(be*i(U*U)),b=i(m*L),I=y+S,O=i(i(I*I)-L-D),h=b+D,l=h-x,g=b-D,p=i(O*l),v=i(h*g),_=i(O*g),T=i(l*h);return new A(p,v,T,_)}add(m){u(m);const{a:y,d:S}=s,{X:U,Y:L,Z:D,T:x}=this,{X:b,Y:I,Z:O,T:h}=m,l=i(U*b),g=i(L*I),p=i(x*S*h),v=i(D*O),_=i((U+L)*(b+I)-l-g),T=v-p,C=v+p,k=i(g-y*l),q=i(_*T),W=i(C*k),ot=i(_*k),Et=i(T*C);return new A(q,W,Et,ot)}subtract(m){return this.add(m.negate())}multiply(m){if(!o.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:y,f:S}=B.cached(this,m,U=>pe(A,U));return pe(A,[y,S])[0]}multiplyUnsafe(m,y=A.ZERO){if(!o.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===gt?A.ZERO:this.is0()||m===M?this:B.unsafe(this,m,S=>pe(A,S),y)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return B.unsafe(this,s.n).is0()}toAffine(m){return E(this,m)}clearCofactor(){return a===M?this:this.multiplyUnsafe(a)}toBytes(){const{x:m,y}=this.toAffine(),S=r.toBytes(y);return S[S.length-1]|=m&M?128:0,S}toHex(){return ce(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}};d(A,"BASE",new A(s.Gx,s.Gy,M,i(s.Gx*s.Gy))),d(A,"ZERO",new A(gt,M,M,gt)),d(A,"Fp",r),d(A,"Fn",o);let R=A;const B=new Dr(R,o.BITS);return R.BASE.precompute(8),R}function $r(t,e,n={}){if(typeof e!="function")throw new Error('"hash" function param is required');ue(n,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r}=n,{BASE:o,Fp:s,Fn:a}=t,c=n.randomBytes||nr,i=n.adjustScalarBytes||(x=>x),f=n.domain||((x,b,I)=>{if(ae(I,"phflag"),b.length||I)throw new Error("Contexts/pre-hash are not supported");return x});function w(x){return a.create(Vt(x))}function u(x){const b=y.secretKey;$(x,y.secretKey,"secretKey");const I=$(e(x),2*b,"hashedSecretKey"),O=i(I.slice(0,b)),h=I.slice(b,2*b),l=w(O);return{head:O,prefix:h,scalar:l}}function E(x){const{head:b,prefix:I,scalar:O}=u(x),h=o.multiply(O),l=h.toBytes();return{head:b,prefix:I,scalar:O,point:h,pointBytes:l}}function K(x){return E(x).pointBytes}function R(x=Uint8Array.of(),...b){const I=Oe(...b);return w(e(f(I,$(x,void 0,"context"),!!r)))}function B(x,b,I={}){x=$(x,void 0,"message"),r&&(x=r(x));const{prefix:O,scalar:h,pointBytes:l}=E(b),g=R(I.context,O,x),p=o.multiply(g).toBytes(),v=R(I.context,p,l,x),_=a.create(g+v*h);if(!a.isValid(_))throw new Error("sign failed: invalid s");const T=Oe(p,a.toBytes(_));return $(T,y.signature,"result")}const A={zip215:!0};function N(x,b,I,O=A){const{context:h,zip215:l}=O,g=y.signature;x=$(x,g,"signature"),b=$(b,void 0,"message"),I=$(I,y.publicKey,"publicKey"),l!==void 0&&ae(l,"zip215"),r&&(b=r(b));const p=g/2,v=x.subarray(0,p),_=Vt(x.subarray(p,g));let T,C,k;try{T=t.fromBytes(I,l),C=t.fromBytes(v,l),k=o.multiplyUnsafe(_)}catch{return!1}if(!l&&T.isSmallOrder())return!1;const q=R(h,C.toBytes(),T.toBytes(),b);return C.add(T.multiplyUnsafe(q)).subtract(k).clearCofactor().is0()}const m=s.BYTES,y={secretKey:m,publicKey:m,signature:2*m,seed:m};function S(x=c(y.seed)){return $(x,y.seed,"seed")}function U(x){return Ce(x)&&x.length===a.BYTES}function L(x,b){try{return!!t.fromBytes(x,b)}catch{return!1}}const D={getExtendedPublicKey:E,randomSecretKey:S,isValidSecretKey:U,isValidPublicKey:L,toMontgomery(x){const{y:b}=t.fromBytes(x),I=y.publicKey,O=I===32;if(!O&&I!==57)throw new Error("only defined for 25519 and 448");const h=O?s.div(M+b,M-b):s.div(b-M,b+M);return s.toBytes(h)},toMontgomerySecret(x){const b=y.secretKey;$(x,b);const I=e(x.subarray(0,b));return i(I).subarray(0,b)}};return Object.freeze({keygen:Lr(S,K),getPublicKey:K,sign:B,verify:N,utils:D,Point:t,lengths:y})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fr=BigInt(1),dn=BigInt(2),zr=BigInt(5),Zr=BigInt(8),xe=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Jr={p:xe,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Zr,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Vr(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=xe,c=t*t%s*t%s,i=tt(c,dn,s)*c%s,f=tt(i,Fr,s)*t%s,w=tt(f,zr,s)*f%s,u=tt(w,e,s)*w%s,E=tt(u,n,s)*u%s,K=tt(E,r,s)*E%s,R=tt(K,o,s)*K%s,B=tt(R,o,s)*K%s,A=tt(B,e,s)*w%s;return{pow_p_5_8:tt(A,dn,s)*t%s,b2:c}}function Yr(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const hn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Gr(t,e){const n=xe,r=j(e*e*e,n),o=j(r*r*e,n),s=Vr(t*o).pow_p_5_8;let a=j(t*r*s,n);const c=j(e*a*a,n),i=a,f=j(a*hn,n),w=c===t,u=c===j(-t,n),E=c===j(-t*hn,n);return w&&(a=i),(u||E)&&(a=f),Rr(a,n)&&(a=j(-a,n)),{isValid:w||u,value:a}}const Xr=Hr(Jr,{uvRatio:Gr});function Wr(t){return $r(Xr,mr,Object.assign({adjustScalarBytes:Yr},t))}const pn=Wr({}),Dt="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";function qt(t){if(!t||typeof t!="string")throw new Error(`Expected base58 string but got “${t}”`);if(t.match(/[IOl0]/gmu))throw new Error(`Invalid base58 character “${t.match(/[IOl0]/gmu)}”`);const e=t.match(/^1+/gmu),n=e?e[0].length:0,r=(t.length-n)*(Math.log(58)/Math.log(256))+1>>>0;return new Uint8Array([...new Uint8Array(n),...t.match(/.{1}/gmu).map(o=>Dt.indexOf(o)).reduce((o,s)=>(o=o.map(a=>{const c=a*58+s;return s=c>>8,c}),o),new Uint8Array(r)).reverse().filter((o=>s=>o=o||s)(!1))])}const Qr=(()=>{const t=Array(256).fill(-1);for(let e=0;e<Dt.length;++e)t[Dt.charCodeAt(e)]=e;return t})();function gn(t){const e=[];for(const n of t){let r=n;for(let o=0;o<e.length;++o){const s=(Qr[e[o]]<<8)+r;e[o]=Dt.charCodeAt(s%58),r=s/58|0}for(;r;)e.push(Dt.charCodeAt(r%58)),r=r/58|0}for(const n of t){if(n)break;e.push(49)}return e.reverse(),String.fromCharCode(...e)}var to=20,eo=1,bt=1e6,yn=1e6,no=-7,ro=21,oo=!1,Lt="[big.js] ",xt=Lt+"Invalid ",Xt=xt+"decimal places",so=xt+"rounding mode",wn=Lt+"Division by zero",P={},et=void 0,io=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function bn(){function t(e){var n=this;if(!(n instanceof t))return e===et&&arguments.length===0?bn():new t(e);if(e instanceof t)n.s=e.s,n.e=e.e,n.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(xt+"value");e=e===0&&1/e<0?"-0":String(e)}co(n,e)}n.constructor=t}return t.prototype=P,t.DP=to,t.RM=eo,t.NE=no,t.PE=ro,t.strict=oo,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function co(t,e){var n,r,o;if(!io.test(e))throw Error(xt+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),o=e.length,r=0;r<o&&e.charAt(r)=="0";)++r;if(r==o)t.c=[t.e=0];else{for(;o>0&&e.charAt(--o)=="0";);for(t.e=n-r-1,t.c=[],n=0;r<=o;)t.c[n++]=+e.charAt(r++)}return t}function mt(t,e,n,r){var o=t.c;if(n===et&&(n=t.constructor.RM),n!==0&&n!==1&&n!==2&&n!==3)throw Error(so);if(e<1)r=n===3&&(r||!!o[0])||e===0&&(n===1&&o[0]>=5||n===2&&(o[0]>5||o[0]===5&&(r||o[1]!==et))),o.length=1,r?(t.e=t.e-e+1,o[0]=1):o[0]=t.e=0;else if(e<o.length){if(r=n===1&&o[e]>=5||n===2&&(o[e]>5||o[e]===5&&(r||o[e+1]!==et||o[e-1]&1))||n===3&&(r||!!o[0]),o.length=e,r){for(;++o[--e]>9;)if(o[e]=0,e===0){++t.e,o.unshift(1);break}}for(e=o.length;!o[--e];)o.pop()}return t}function vt(t,e,n){var r=t.e,o=t.c.join(""),s=o.length;if(e)o=o.charAt(0)+(s>1?"."+o.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)o="0"+o;o="0."+o}else if(r>0)if(++r>s)for(r-=s;r--;)o+="0";else r<s&&(o=o.slice(0,r)+"."+o.slice(r));else s>1&&(o=o.charAt(0)+"."+o.slice(1));return t.s<0&&n?"-"+o:o}P.abs=function(){var t=new this.constructor(this);return t.s=1,t},P.cmp=function(t){var e,n=this,r=n.c,o=(t=new n.constructor(t)).c,s=n.s,a=t.s,c=n.e,i=t.e;if(!r[0]||!o[0])return r[0]?s:o[0]?-a:0;if(s!=a)return s;if(e=s<0,c!=i)return c>i^e?1:-1;for(a=(c=r.length)<(i=o.length)?c:i,s=-1;++s<a;)if(r[s]!=o[s])return r[s]>o[s]^e?1:-1;return c==i?0:c>i^e?1:-1},P.div=function(t){var e=this,n=e.constructor,r=e.c,o=(t=new n(t)).c,s=e.s==t.s?1:-1,a=n.DP;if(a!==~~a||a<0||a>bt)throw Error(Xt);if(!o[0])throw Error(wn);if(!r[0])return t.s=s,t.c=[t.e=0],t;var c,i,f,w,u,E=o.slice(),K=c=o.length,R=r.length,B=r.slice(0,c),A=B.length,N=t,m=N.c=[],y=0,S=a+(N.e=e.e-t.e)+1;for(N.s=s,s=S<0?0:S,E.unshift(0);A++<c;)B.push(0);do{for(f=0;f<10;f++){if(c!=(A=B.length))w=c>A?1:-1;else for(u=-1,w=0;++u<c;)if(o[u]!=B[u]){w=o[u]>B[u]?1:-1;break}if(w<0){for(i=A==c?o:E;A;){if(B[--A]<i[A]){for(u=A;u&&!B[--u];)B[u]=9;--B[u],B[A]+=10}B[A]-=i[A]}for(;!B[0];)B.shift()}else break}m[y++]=w?f:++f,B[0]&&w?B[A]=r[K]||0:B=[r[K]]}while((K++<R||B[0]!==et)&&s--);return!m[0]&&y!=1&&(m.shift(),N.e--,S--),y>S&&mt(N,S,n.RM,B[0]!==et),N},P.eq=function(t){return this.cmp(t)===0},P.gt=function(t){return this.cmp(t)>0},P.gte=function(t){return this.cmp(t)>-1},P.lt=function(t){return this.cmp(t)<0},P.lte=function(t){return this.cmp(t)<1},P.minus=P.sub=function(t){var e,n,r,o,s=this,a=s.constructor,c=s.s,i=(t=new a(t)).s;if(c!=i)return t.s=-i,s.plus(t);var f=s.c.slice(),w=s.e,u=t.c,E=t.e;if(!f[0]||!u[0])return u[0]?t.s=-i:f[0]?t=new a(s):t.s=1,t;if(c=w-E){for((o=c<0)?(c=-c,r=f):(E=w,r=u),r.reverse(),i=c;i--;)r.push(0);r.reverse()}else for(n=((o=f.length<u.length)?f:u).length,c=i=0;i<n;i++)if(f[i]!=u[i]){o=f[i]<u[i];break}if(o&&(r=f,f=u,u=r,t.s=-t.s),(i=(n=u.length)-(e=f.length))>0)for(;i--;)f[e++]=0;for(i=e;n>c;){if(f[--n]<u[n]){for(e=n;e&&!f[--e];)f[e]=9;--f[e],f[n]+=10}f[n]-=u[n]}for(;f[--i]===0;)f.pop();for(;f[0]===0;)f.shift(),--E;return f[0]||(t.s=1,f=[E=0]),t.c=f,t.e=E,t},P.mod=function(t){var e,n=this,r=n.constructor,o=n.s,s=(t=new r(t)).s;if(!t.c[0])throw Error(wn);return n.s=t.s=1,e=t.cmp(n)==1,n.s=o,t.s=s,e?new r(n):(o=r.DP,s=r.RM,r.DP=r.RM=0,n=n.div(t),r.DP=o,r.RM=s,this.minus(n.times(t)))},P.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t},P.plus=P.add=function(t){var e,n,r,o=this,s=o.constructor;if(t=new s(t),o.s!=t.s)return t.s=-t.s,o.minus(t);var a=o.e,c=o.c,i=t.e,f=t.c;if(!c[0]||!f[0])return f[0]||(c[0]?t=new s(o):t.s=o.s),t;if(c=c.slice(),e=a-i){for(e>0?(i=a,r=f):(e=-e,r=c),r.reverse();e--;)r.push(0);r.reverse()}for(c.length-f.length<0&&(r=f,f=c,c=r),e=f.length,n=0;e;c[e]%=10)n=(c[--e]=c[e]+f[e]+n)/10|0;for(n&&(c.unshift(n),++i),e=c.length;c[--e]===0;)c.pop();return t.c=c,t.e=i,t},P.pow=function(t){var e=this,n=new e.constructor("1"),r=n,o=t<0;if(t!==~~t||t<-yn||t>yn)throw Error(xt+"exponent");for(o&&(t=-t);t&1&&(r=r.times(e)),t>>=1,!!t;)e=e.times(e);return o?n.div(r):r},P.prec=function(t,e){if(t!==~~t||t<1||t>bt)throw Error(xt+"precision");return mt(new this.constructor(this),t,e)},P.round=function(t,e){if(t===et)t=0;else if(t!==~~t||t<-bt||t>bt)throw Error(Xt);return mt(new this.constructor(this),t+this.e+1,e)},P.sqrt=function(){var t,e,n,r=this,o=r.constructor,s=r.s,a=r.e,c=new o("0.5");if(!r.c[0])return new o(r);if(s<0)throw Error(Lt+"No square root");s=Math.sqrt(+vt(r,!0,!0)),s===0||s===1/0?(e=r.c.join(""),e.length+a&1||(e+="0"),s=Math.sqrt(e),a=((a+1)/2|0)-(a<0||a&1),t=new o((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+a)):t=new o(s+""),a=t.e+(o.DP+=4);do n=t,t=c.times(n.plus(r.div(n)));while(n.c.slice(0,a).join("")!==t.c.slice(0,a).join(""));return mt(t,(o.DP-=4)+t.e+1,o.RM)},P.times=P.mul=function(t){var e,n=this,r=n.constructor,o=n.c,s=(t=new r(t)).c,a=o.length,c=s.length,i=n.e,f=t.e;if(t.s=n.s==t.s?1:-1,!o[0]||!s[0])return t.c=[t.e=0],t;for(t.e=i+f,a<c&&(e=o,o=s,s=e,f=a,a=c,c=f),e=new Array(f=a+c);f--;)e[f]=0;for(i=c;i--;){for(c=0,f=a+i;f>i;)c=e[f]+s[i]*o[f-i-1]+c,e[f--]=c%10,c=c/10|0;e[f]=c}for(c?++t.e:e.shift(),i=e.length;!e[--i];)e.pop();return t.c=e,t},P.toExponential=function(t,e){var n=this,r=n.c[0];if(t!==et){if(t!==~~t||t<0||t>bt)throw Error(Xt);for(n=mt(new n.constructor(n),++t,e);n.c.length<t;)n.c.push(0)}return vt(n,!0,!!r)},P.toFixed=function(t,e){var n=this,r=n.c[0];if(t!==et){if(t!==~~t||t<0||t>bt)throw Error(Xt);for(n=mt(new n.constructor(n),t+n.e+1,e),t=t+n.e+1;n.c.length<t;)n.c.push(0)}return vt(n,!1,!!r)},P.toJSON=P.toString=function(){var t=this,e=t.constructor;return vt(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])},typeof Symbol<"u"&&(P[Symbol.for("nodejs.util.inspect.custom")]=P.toJSON),P.toNumber=function(){var t=+vt(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(Lt+"Imprecise conversion");return t},P.toPrecision=function(t,e){var n=this,r=n.constructor,o=n.c[0];if(t!==et){if(t!==~~t||t<1||t>bt)throw Error(xt+"precision");for(n=mt(new r(n),t,e);n.c.length<t;)n.c.push(0)}return vt(n,t<=n.e||n.e<=r.NE||n.e>=r.PE,!!o)},P.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(Lt+"valueOf disallowed");return vt(t,t.e<=e.NE||t.e>=e.PE,!0)};var nt=bn();const Ct=typeof Buffer=="function",xn=typeof TextDecoder=="function"?new TextDecoder:void 0,mn=typeof TextEncoder=="function"?new TextEncoder:void 0,jt=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Wt=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(jt),ao=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,F=String.fromCharCode.bind(String),vn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),En=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),An=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),_n=typeof btoa=="function"?t=>btoa(t):Ct?t=>Buffer.from(t,"binary").toString("base64"):t=>{let e,n,r,o,s="";const a=t.length%3;for(let c=0;c<t.length;){if((n=t.charCodeAt(c++))>255||(r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,s+=jt[e>>18&63]+jt[e>>12&63]+jt[e>>6&63]+jt[e&63]}return a?s.slice(0,a-3)+"===".substring(a):s},me=Ct?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(F.apply(null,t.subarray(r,r+4096)));return _n(n.join(""))},fo=(t,e=!1)=>e?En(me(t)):me(t),uo=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?F(192|e>>>6)+F(128|e&63):F(224|e>>>12&15)+F(128|e>>>6&63)+F(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return F(240|e>>>18&7)+F(128|e>>>12&63)+F(128|e>>>6&63)+F(128|e&63)}},lo=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ho=t=>t.replace(lo,uo),Sn=Ct?t=>Buffer.from(t,"utf8").toString("base64"):mn?t=>me(mn.encode(t)):t=>_n(ho(t)),po=(t,e=!1)=>e?En(Sn(t)):Sn(t),go=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,yo=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return F((n>>>10)+55296)+F((n&1023)+56320);case 3:return F((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return F((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},wo=t=>t.replace(go,yo),In=typeof atob=="function"?t=>atob(An(t)):Ct?t=>Buffer.from(t,"base64").toString("binary"):t=>{if(t=t.replace(/\s+/g,""),!ao.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n,r,o=[];for(let s=0;s<t.length;)e=Wt[t.charAt(s++)]<<18|Wt[t.charAt(s++)]<<12|(n=Wt[t.charAt(s++)])<<6|(r=Wt[t.charAt(s++)]),n===64?o.push(F(e>>16&255)):r===64?o.push(F(e>>16&255,e>>8&255)):o.push(F(e>>16&255,e>>8&255,e&255));return o.join("")},Bn=Ct?t=>vn(Buffer.from(t,"base64")):t=>vn(In(t).split("").map(e=>e.charCodeAt(0))),bo=t=>Bn(Tn(t)),xo=Ct?t=>Buffer.from(t,"base64").toString("utf8"):xn?t=>xn.decode(Bn(t)):t=>wo(In(t)),Tn=t=>An(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),mo=t=>xo(Tn(t));var vo=Object.defineProperty,rt=(t,e)=>vo(t,"name",{value:e,configurable:!0});const ve="__fastnear_",Eo=rt(()=>typeof localStorage<"u"?localStorage:{getItem:rt(t=>Qt.get(t)||null,"getItem"),setItem:rt((t,e)=>Qt.set(t,e),"setItem"),removeItem:rt(t=>Qt.delete(t),"removeItem"),clear:rt(()=>Qt.clear(),"clear")},"createDefaultStorage"),Qt=new Map;let Kt=Eo();const Cn={setBackend:rt(t=>{Kt=t},"setBackend"),set:rt((t,e)=>{e==null?Kt.removeItem(ve+t):Kt.setItem(ve+t,JSON.stringify(e))},"set"),get:rt(t=>{const e=Kt.getItem(ve+t);if(e===null)return null;try{return JSON.parse(e)}catch{return e}},"get"),remove:rt(t=>Kt.removeItem(t),"remove"),clear:rt(()=>Kt.clear(),"clear")};var Ao=Object.defineProperty,Y=(t,e)=>Ao(t,"name",{value:e,configurable:!0});function _o(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}Y(_o,"toHex");function So(t){if(t.length%2)throw new Error("Hex string must be even length");const e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=parseInt(t.slice(n,n+2),16);return e}Y(So,"fromHex");function Ee(t){return bo(t)}Y(Ee,"base64ToBytes");function te(t){return fo(t)}Y(te,"bytesToBase64");function Io(t){try{return po(t)}catch(e){return console.error("Issue base64 encoding",e),null}}Y(Io,"toBase64");function Bo(t){try{return mo(t)}catch(e){return console.error("Issue base64 decoding",e),null}}Y(Bo,"fromBase64");function To(t,...e){if(Array.isArray(t)&&(t=t.reduce((n,r,o)=>n+(e[o-1]??"")+r)),typeof t=="string"){const n=t.match(/([0-9.,_]+)\s*([a-zA-Z]+)?/);if(n){const r=n[1].replace(/[_,]/g,""),o=n[2];if(o)switch(o.toLowerCase()){case"near":return nt(r).mul(nt(10).pow(24)).toFixed(0);case"tgas":return nt(r).mul(nt(10).pow(12)).toFixed(0);case"ggas":return nt(r).mul(nt(10).pow(9)).toFixed(0);case"gas":case"yoctonear":return nt(r).toFixed(0);default:throw new Error(`Unknown unit: ${o}`)}else return nt(r).toFixed(0)}}return nt(`${t}`).toFixed(0)}Y(To,"convertUnit");function Co(t,e){Cn.set(t,e)}Y(Co,"lsSet");function Ko(t){return Cn.get(t)}Y(Ko,"lsGet");function Ro(t){return JSON.parse(JSON.stringify(t))}Y(Ro,"deepCopy");function No(...t){try{return JSON.parse(t[0])}catch{return t.length>1?t[1]:t[0]}}Y(No,"tryParseJson");function Uo(t){try{const e=new TextDecoder;return JSON.parse(e.decode(t instanceof Uint8Array?t:new Uint8Array(t)))}catch{try{return t instanceof Uint8Array?t:new Uint8Array(t)}catch{return t}}}Y(Uo,"parseJsonFromBytes");function Oo(t){var e;return t.length===1&&t[0].type==="FunctionCall"&&nt(((e=t[0])==null?void 0:e.deposit)??"0").eq(0)}Y(Oo,"canSignWithLAK");var Po=Object.defineProperty,Rt=(t,e)=>Po(t,"name",{value:e,configurable:!0});const Nt=Rt(t=>qt(t.includes(":")?(()=>{const[e,n]=t.split(":");if(e!=="ed25519")throw new Error(`Unsupported curve: ${e}`);return n})():t),"keyFromString"),Kn=Rt(t=>`ed25519:${gn(t)}`,"keyToString");function Ut(t){const e=Nt(t).slice(0,32),n=pn.getPublicKey(e);return Kn(n)}Rt(Ut,"publicKeyFromPrivate");function ee(){const t=crypto.getRandomValues(new Uint8Array(64));return Kn(t)}Rt(ee,"privateKeyFromRandom");function Ae(t,e,n){const r=Nt(e).slice(0,32),o=pn.sign(t,r);return n!=null&&n.returnBase58?gn(o):o}Rt(Ae,"signHash");function ko(t,e){const n=He(t);return Ae(n,e)}Rt(ko,"signBytes");var Do=Object.defineProperty,Rn=(t,e)=>Do(t,"name",{value:e,configurable:!0});const qo=new(Ot=class{constructor(){d(this,"Ed25519Signature",{struct:{data:{array:{type:"u8",len:64}}}});d(this,"Secp256k1Signature",{struct:{data:{array:{type:"u8",len:65}}}});d(this,"Signature",{enum:[{struct:{ed25519Signature:this.Ed25519Signature}},{struct:{secp256k1Signature:this.Secp256k1Signature}}]});d(this,"Ed25519Data",{struct:{data:{array:{type:"u8",len:32}}}});d(this,"Secp256k1Data",{struct:{data:{array:{type:"u8",len:64}}}});d(this,"PublicKey",{enum:[{struct:{ed25519Key:this.Ed25519Data}},{struct:{secp256k1Key:this.Secp256k1Data}}]});d(this,"FunctionCallPermission",{struct:{allowance:{option:"u128"},receiverId:"string",methodNames:{array:{type:"string"}}}});d(this,"FullAccessPermission",{struct:{}});d(this,"AccessKeyPermission",{enum:[{struct:{functionCall:this.FunctionCallPermission}},{struct:{fullAccess:this.FullAccessPermission}}]});d(this,"AccessKey",{struct:{nonce:"u64",permission:this.AccessKeyPermission}});d(this,"CreateAccount",{struct:{}});d(this,"DeployContract",{struct:{code:{array:{type:"u8"}}}});d(this,"FunctionCall",{struct:{methodName:"string",args:{array:{type:"u8"}},gas:"u64",deposit:"u128"}});d(this,"Transfer",{struct:{deposit:"u128"}});d(this,"Stake",{struct:{stake:"u128",publicKey:this.PublicKey}});d(this,"AddKey",{struct:{publicKey:this.PublicKey,accessKey:this.AccessKey}});d(this,"DeleteKey",{struct:{publicKey:this.PublicKey}});d(this,"DeleteAccount",{struct:{beneficiaryId:"string"}});d(this,"ClassicAction",{enum:[{struct:{createAccount:this.CreateAccount}},{struct:{deployContract:this.DeployContract}},{struct:{functionCall:this.FunctionCall}},{struct:{transfer:this.Transfer}},{struct:{stake:this.Stake}},{struct:{addKey:this.AddKey}},{struct:{deleteKey:this.DeleteKey}},{struct:{deleteAccount:this.DeleteAccount}}]});d(this,"DelegateAction",{struct:{senderId:"string",receiverId:"string",actions:{array:{type:this.ClassicAction}},nonce:"u64",maxBlockHeight:"u64",publicKey:this.PublicKey}});d(this,"SignedDelegate",{struct:{delegateAction:this.DelegateAction,signature:this.Signature}});d(this,"Action",{enum:[{struct:{createAccount:this.CreateAccount}},{struct:{deployContract:this.DeployContract}},{struct:{functionCall:this.FunctionCall}},{struct:{transfer:this.Transfer}},{struct:{stake:this.Stake}},{struct:{addKey:this.AddKey}},{struct:{deleteKey:this.DeleteKey}},{struct:{deleteAccount:this.DeleteAccount}},{struct:{signedDelegate:this.SignedDelegate}}]});d(this,"Transaction",{struct:{signerId:"string",publicKey:this.PublicKey,nonce:"u64",receiverId:"string",blockHash:{array:{type:"u8",len:32}},actions:{array:{type:this.Action}}}});d(this,"SignedTransaction",{struct:{transaction:this.Transaction,signature:this.Signature}})}},Rn(Ot,"BorshSchema"),Ot),Lo=Rn(()=>qo,"getBorshSchema");var jo=Object.defineProperty,ne=(t,e)=>jo(t,"name",{value:e,configurable:!0});function Mt(t){return{signerId:t.signerId,publicKey:{ed25519Key:{data:Nt(t.publicKey)}},nonce:BigInt(t.nonce),receiverId:t.receiverId,blockHash:qt(t.blockHash),actions:t.actions.map(_e)}}ne(Mt,"mapTransaction");function Mo(t){console.log("fastnear: serializing transaction");const e=Mt(t);return console.log("fastnear: mapped transaction for borsh:",e),Pt(Ht.Transaction,e)}ne(Mo,"serializeTransaction");function Ho(t,e){console.log("fastnear: Serializing Signed Transaction",t),console.log("fastnear: signature",e),console.log("fastnear: signature length",qt(e).length);const n=Mt(t);console.log("fastnear: mapped (for borsh schema) signed transaction",n);const r={transaction:n,signature:{ed25519Signature:{data:qt(e)}}},o=Pt(Ht.SignedTransaction,r,!0);return console.log("fastnear: borsh-serialized signed transaction:",o),o}ne(Ho,"serializeSignedTransaction");function _e(t){switch(t.type){case"CreateAccount":return{createAccount:{}};case"DeployContract":return{deployContract:{code:Ee(t.codeBase64)}};case"FunctionCall":return{functionCall:{methodName:t.methodName,args:t.argsBase64!==null&&t.argsBase64!==void 0?Ee(t.argsBase64):new TextEncoder().encode(JSON.stringify(t.args)),gas:BigInt(t.gas??"300000000000000"),deposit:BigInt(t.deposit??"0")}};case"Transfer":return{transfer:{deposit:BigInt(t.deposit)}};case"Stake":return{stake:{stake:BigInt(t.stake),publicKey:{ed25519Key:{data:Nt(t.publicKey)}}}};case"AddKey":return{addKey:{publicKey:{ed25519Key:{data:Nt(t.publicKey)}},accessKey:{nonce:BigInt(t.accessKey.nonce),permission:t.accessKey.permission==="FullAccess"?{fullAccess:{}}:{functionCall:{allowance:t.accessKey.allowance?BigInt(t.accessKey.allowance):null,receiverId:t.accessKey.receiverId,methodNames:t.accessKey.methodNames}}}}};case"DeleteKey":return{deleteKey:{publicKey:{ed25519Key:{data:Nt(t.publicKey)}}}};case"DeleteAccount":return{deleteAccount:{beneficiaryId:t.beneficiaryId}};case"SignedDelegate":return{signedDelegate:{delegateAction:_e(t.delegateAction),signature:{ed25519Signature:qt(t.signature)}}};default:throw new Error("Not implemented action: "+t.type)}}ne(_e,"mapAction");const Ht=Lo(),Nn=t=>{let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)},$o=t=>Nn(new TextEncoder().encode(t));let Fo=123;class re extends Error{constructor(n,r){super(n);d(this,"type");this.type=r}}class $t extends Error{constructor(e,n,r){super(`${e} ${n}: ${r}`)}}class Un extends $t{constructor(e){super(0,e,"Timeout error")}}const zo=t=>new Promise(e=>setTimeout(e,t)),On=Math.random()>.5,Pn=["https://relmn.aurora.dev","https://nearrpc.aurora.dev",On?"https://c1.rpc.fastnear.com":"https://c2.rpc.fastnear.com",On?"https://c2.rpc.fastnear.com":"https://c1.rpc.fastnear.com"];class kn{constructor(e=Pn,n=3e4,r=3,o=!0){d(this,"providers");d(this,"currentProviderIndex",0);d(this,"startTimeout");this.timeout=n,this.triesCountForEveryProvider=r,this.incrementTimout=o,this.currentProviderIndex=0,this.providers=e.length>0?e:Pn,this.startTimeout=n}async block(e){return this.sendJsonRpc("block",e)}async query(e){return this.sendJsonRpc("query",e)}async txStatus(e,n,r){return this.sendJsonRpc("tx",{tx_hash:e,sender_account_id:n,wait_until:r})}async sendTransaction(e){const n=e.encode();return this.sendJsonRpc("send_tx",{signed_tx_base64:Nn(new Uint8Array(n)),wait_until:"EXECUTED_OPTIMISTIC"})}async viewMethod(e){const n=$o(JSON.stringify(e.args)),r=await this.query({args_base64:n,finality:"optimistic",request_type:"call_function",method_name:e.methodName,account_id:e.contractId});return JSON.parse(new TextDecoder().decode(new Uint8Array(r.result)))}async sendJsonRpc(e,n,r=0){const o=this.providers[this.currentProviderIndex],s=Date.now();try{const a=await this.send(e,n,o,this.timeout);return this.timeout=Math.max(this.startTimeout,this.timeout/1.2),a}catch(a){if(a instanceof Un&&this.incrementTimout&&(this.timeout=Math.min(6e4,this.timeout*1.2)),a instanceof $t){if(this.currentProviderIndex+=1,this.providers[this.currentProviderIndex]==null&&(this.currentProviderIndex=0),r+1>this.providers.length*this.triesCountForEveryProvider)throw a;const c=500*r,i=Date.now()-s;return i<c&&await zo(c-i),await this.sendJsonRpc(e,n,r+1)}throw a}}async send(e,n,r,o){const s=new AbortController,a=setTimeout(()=>s.abort(),o),c=await fetch(r,{body:JSON.stringify({method:e,params:n,id:Fo++,jsonrpc:"2.0"}),headers:{"Content-Type":"application/json",Referer:"https://my.herewallet.app"},signal:s.signal,method:"POST"}).catch(()=>{throw clearInterval(a),s.signal.aborted?new Un("RPC Network Error"):window.navigator.onLine?new $t(0,"RPC Network Error","Unknown Near RPC Error, maybe connection unstable, try VPN"):new $t(0,"RPC Network Error","No internet connection")});if(clearInterval(a),!c.ok){const f=await c.text().catch(()=>"Unknown error");throw new $t(c.status,"RPC Network Error",f)}const i=await c.json();if(i.error){if(typeof i.error.data=="object")throw typeof i.error.data.error_message=="string"&&typeof i.error.data.error_type=="string"?new re(i.error.data.error_message,i.error.data.error_type):new re(JSON.stringify(i.error.data),"ServerError");const f=`[${i.error.code}] ${i.error.message}: ${i.error.data}`;throw i.error.data==="Timeout"||f.includes("Timeout error")||f.includes("query has timed out")?new re(f,"TimeoutError"):new re(f,i.error.name||"UntypedError")}return i.result}}new kn;var Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Jo={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Zo,function(){/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var n=Object.prototype.toString,r=Array.isArray||function(l){return n.call(l)==="[object Array]"};function o(h){return typeof h=="function"}function s(h){return r(h)?"array":typeof h}function a(h){return h.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function c(h,l){return h!=null&&typeof h=="object"&&l in h}function i(h,l){return h!=null&&typeof h!="object"&&h.hasOwnProperty&&h.hasOwnProperty(l)}var f=RegExp.prototype.test;function w(h,l){return f.call(h,l)}var u=/\S/;function E(h){return!w(u,h)}var K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function R(h){return String(h).replace(/[&<>"'`=\/]/g,function(g){return K[g]})}var B=/\s*/,A=/\s+/,N=/\s*=/,m=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/;function S(h,l){if(!h)return[];var g=!1,p=[],v=[],_=[],T=!1,C=!1,k="",q=0;function W(){if(T&&!C)for(;_.length;)delete v[_.pop()];else _=[];T=!1,C=!1}var ot,Et,Fn;function zn(at){if(typeof at=="string"&&(at=at.split(A,2)),!r(at)||at.length!==2)throw new Error("Invalid tags: "+at);ot=new RegExp(a(at[0])+"\\s*"),Et=new RegExp("\\s*"+a(at[1])),Fn=new RegExp("\\s*"+a("}"+at[1]))}zn(l||I.tags);for(var H=new D(h),yt,V,X,Ft,oe,At;!H.eos();){if(yt=H.pos,X=H.scanUntil(ot),X)for(var Se=0,Go=X.length;Se<Go;++Se)Ft=X.charAt(Se),E(Ft)?(_.push(v.length),k+=Ft):(C=!0,g=!0,k+=" "),v.push(["text",Ft,yt,yt+1]),yt+=1,Ft===`
`&&(W(),k="",q=0,g=!1);if(!H.scan(ot))break;if(T=!0,V=H.scan(y)||"name",H.scan(B),V==="="?(X=H.scanUntil(N),H.scan(N),H.scanUntil(Et)):V==="{"?(X=H.scanUntil(Fn),H.scan(m),H.scanUntil(Et),V="&"):X=H.scanUntil(Et),!H.scan(Et))throw new Error("Unclosed tag at "+H.pos);if(V==">"?oe=[V,X,yt,H.pos,k,q,g]:oe=[V,X,yt,H.pos],q++,v.push(oe),V==="#"||V==="^")p.push(oe);else if(V==="/"){if(At=p.pop(),!At)throw new Error('Unopened section "'+X+'" at '+yt);if(At[1]!==X)throw new Error('Unclosed section "'+At[1]+'" at '+yt)}else V==="name"||V==="{"||V==="&"?C=!0:V==="="&&zn(X)}if(W(),At=p.pop(),At)throw new Error('Unclosed section "'+At[1]+'" at '+H.pos);return L(U(v))}function U(h){for(var l=[],g,p,v=0,_=h.length;v<_;++v)g=h[v],g&&(g[0]==="text"&&p&&p[0]==="text"?(p[1]+=g[1],p[3]=g[3]):(l.push(g),p=g));return l}function L(h){for(var l=[],g=l,p=[],v,_,T=0,C=h.length;T<C;++T)switch(v=h[T],v[0]){case"#":case"^":g.push(v),p.push(v),g=v[4]=[];break;case"/":_=p.pop(),_[5]=v[2],g=p.length>0?p[p.length-1][4]:l;break;default:g.push(v)}return l}function D(h){this.string=h,this.tail=h,this.pos=0}D.prototype.eos=function(){return this.tail===""},D.prototype.scan=function(l){var g=this.tail.match(l);if(!g||g.index!==0)return"";var p=g[0];return this.tail=this.tail.substring(p.length),this.pos+=p.length,p},D.prototype.scanUntil=function(l){var g=this.tail.search(l),p;switch(g){case-1:p=this.tail,this.tail="";break;case 0:p="";break;default:p=this.tail.substring(0,g),this.tail=this.tail.substring(g)}return this.pos+=p.length,p};function x(h,l){this.view=h,this.cache={".":this.view},this.parent=l}x.prototype.push=function(l){return new x(l,this)},x.prototype.lookup=function(l){var g=this.cache,p;if(g.hasOwnProperty(l))p=g[l];else{for(var v=this,_,T,C,k=!1;v;){if(l.indexOf(".")>0)for(_=v.view,T=l.split("."),C=0;_!=null&&C<T.length;)C===T.length-1&&(k=c(_,T[C])||i(_,T[C])),_=_[T[C++]];else _=v.view[l],k=c(v.view,l);if(k){p=_;break}v=v.parent}g[l]=p}return o(p)&&(p=p.call(this.view)),p};function b(){this.templateCache={_cache:{},set:function(l,g){this._cache[l]=g},get:function(l){return this._cache[l]},clear:function(){this._cache={}}}}b.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},b.prototype.parse=function(l,g){var p=this.templateCache,v=l+":"+(g||I.tags).join(":"),_=typeof p<"u",T=_?p.get(v):void 0;return T==null&&(T=S(l,g),_&&p.set(v,T)),T},b.prototype.render=function(l,g,p,v){var _=this.parse(l,v),T=g instanceof x?g:new x(g,void 0);return this.renderTokens(_,T,p,l,v)},b.prototype.renderTokens=function(l,g,p,v,_){for(var T="",C,k,q,W=0,ot=l.length;W<ot;++W)q=void 0,C=l[W],k=C[0],k==="#"?q=this.renderSection(C,g,p,v):k==="^"?q=this.renderInverted(C,g,p,v):k===">"?q=this.renderPartial(C,g,p,_):k==="&"?q=this.unescapedValue(C,g):k==="name"?q=this.escapedValue(C,g):k==="text"&&(q=this.rawValue(C)),q!==void 0&&(T+=q);return T},b.prototype.renderSection=function(l,g,p,v){var _=this,T="",C=g.lookup(l[1]);function k(ot){return _.render(ot,g,p)}if(C){if(r(C))for(var q=0,W=C.length;q<W;++q)T+=this.renderTokens(l[4],g.push(C[q]),p,v);else if(typeof C=="object"||typeof C=="string"||typeof C=="number")T+=this.renderTokens(l[4],g.push(C),p,v);else if(o(C)){if(typeof v!="string")throw new Error("Cannot use higher-order sections without the original template");C=C.call(g.view,v.slice(l[3],l[5]),k),C!=null&&(T+=C)}else T+=this.renderTokens(l[4],g,p,v);return T}},b.prototype.renderInverted=function(l,g,p,v){var _=g.lookup(l[1]);if(!_||r(_)&&_.length===0)return this.renderTokens(l[4],g,p,v)},b.prototype.indentPartial=function(l,g,p){for(var v=g.replace(/[^ \t]/g,""),_=l.split(`
`),T=0;T<_.length;T++)_[T].length&&(T>0||!p)&&(_[T]=v+_[T]);return _.join(`
`)},b.prototype.renderPartial=function(l,g,p,v){if(p){var _=o(p)?p(l[1]):p[l[1]];if(_!=null){var T=l[6],C=l[5],k=l[4],q=_;return C==0&&k&&(q=this.indentPartial(_,k,T)),this.renderTokens(this.parse(q,v),g,p,q)}}},b.prototype.unescapedValue=function(l,g){var p=g.lookup(l[1]);if(p!=null)return p},b.prototype.escapedValue=function(l,g){var p=g.lookup(l[1]);if(p!=null)return I.escape(p)},b.prototype.rawValue=function(l){return l[1]};var I={name:"mustache.js",version:"4.0.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(h){O.templateCache=h},get templateCache(){return O.templateCache}},O=new b;return I.clearCache=function(){return O.clearCache()},I.parse=function(l,g){return O.parse(l,g)},I.render=function(l,g,p,v){if(typeof l!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+s(l)+'" was given as the first argument for mustache#render(template, view, partials)');return O.render(l,g,p,v)},I.escape=R,I.Scanner=D,I.Context=x,I.Writer=b,I})})(Jo);var Dn;(function(t){t.Transaction="transaction",t.Receipt="receipt"})(Dn||(Dn={}));var qn;(function(t){t.Unknown="Unknown",t.Pending="Pending",t.Failure="Failure"})(qn||(qn={}));var Ln;(function(t){t.NotStarted="NotStarted",t.Started="Started",t.Failure="Failure"})(Ln||(Ln={})),10n**BigInt(24);const Vo=t=>{let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)},jn=t=>t.map(e=>{if(!("type"in e))return e;switch(e.type){case"FunctionCall":return{type:"FunctionCall",methodName:e.params.methodName,args:e.params.args,gas:e.params.gas,deposit:e.params.deposit};case"Transfer":return{type:"Transfer",deposit:e.params.deposit};case"AddKey":return{type:"AddKey",publicKey:e.params.publicKey,accessKey:{nonce:e.params.accessKey.nonce??0,permission:e.params.accessKey.permission==="FullAccess"?"FullAccess":{receiverId:e.params.accessKey.permission.receiverId,methodNames:e.params.accessKey.permission.methodNames??[],allowance:e.params.accessKey.permission.allowance}}};case"DeleteKey":return{type:"DeleteKey",publicKey:e.params.publicKey};case"CreateAccount":return{type:"CreateAccount"};case"DeleteAccount":return{type:"DeleteAccount",beneficiaryId:e.params.beneficiaryId};case"DeployContract":return{type:"DeployContract",codeBase64:Vo(e.params.code)};case"Stake":return{type:"Stake",stake:e.params.stake,publicKey:e.params.publicKey};default:throw new Error("Unsupported action type")}}),Mn=480,Hn=640,Yo=300;class $n{constructor(e,n){d(this,"walletUrl");d(this,"signedAccountId");d(this,"functionCallKey");d(this,"provider");d(this,"network");var s,a;const r=window.localStorage.getItem("near_app_wallet_auth_key");if(r){const{accountId:c}=JSON.parse(r);window.localStorage.setItem("signedAccountId",c),window.localStorage.removeItem("near_app_wallet_auth_key");const i=window.localStorage.getItem(`near-api-js:keystore:${c}:${n.networkId}`);if(i){const{contractId:f,methodNames:w}=JSON.parse(window.localStorage.getItem("near-wallet-selector:contract")||"{}");this.functionCallKey={privateKey:i,contractId:f,methods:w||[]},window.localStorage.setItem("functionCallKey",JSON.stringify(this.functionCallKey)),window.localStorage.removeItem(`near-api-js:keystore:${c}:${n.networkId}`)}}this.walletUrl=e,this.provider=new kn(((a=(s=window.selector)==null?void 0:s.providers)==null?void 0:a[n.networkId])||[n.nodeUrl]),this.signedAccountId=window.localStorage.getItem("signedAccountId")||"";const o=window.localStorage.getItem("functionCallKey");this.functionCallKey=o?JSON.parse(o):null,this.network=n}getAccountId(){return this.signedAccountId}getPublicKey(){if(this.functionCallKey)return Ut(this.functionCallKey.privateKey)}isSignedIn(){return!!this.signedAccountId}signOut(){this.signedAccountId="",this.functionCallKey=null,window.localStorage.removeItem("signedAccountId"),window.localStorage.removeItem("functionCallKey");const e=[];for(let n=0;n<window.localStorage.length;n++){const r=window.localStorage.key(n);r&&r.startsWith("functionCallKey:")&&e.push(r)}e.forEach(n=>window.localStorage.removeItem(n))}async requestSignIn({contractId:e,methodNames:n}){const r=await this.requestSignInUrl({contractId:e,methodNames:n});return await this.handlePopupTransaction(r,async o=>{const s=o,{public_key:a,account_id:c}=s;if(c)return this.signedAccountId=c,window.localStorage.setItem("signedAccountId",c),[{accountId:c,publicKey:a||""}];throw new Error("Invalid response data from wallet")})}async requestSignInUrl({contractId:e,methodNames:n}){const r=new URL(window.selector.location),o=new URL(`${this.walletUrl}/login/`);if(o.searchParams.set("success_url",r.href),o.searchParams.set("failure_url",r.href),e){o.searchParams.set("contract_id",e);const s=ee(),a=Ut(s);o.searchParams.set("public_key",a),this.functionCallKey={privateKey:s,contractId:e,methods:n||[]},window.localStorage.setItem("functionCallKey",JSON.stringify(this.functionCallKey))}return n&&n.forEach(s=>{o.searchParams.append("methodNames",s)}),o.toString()}async signMessage({message:e,nonce:n,recipient:r,callbackUrl:o,state:s}){const a=o||window.selector.location;if(!a)throw new Error("MyNearWallet: CallbackUrl is missing");const c=new URL(this.walletUrl);return c.pathname="sign-message",c.searchParams.append("message",e),c.searchParams.append("nonce",te(new Uint8Array(n))),c.searchParams.append("recipient",r),c.searchParams.append("callbackUrl",a),s&&c.searchParams.append("state",s),await this.handlePopupTransaction(c.toString(),i=>{var f,w,u;return{accountId:((f=i==null?void 0:i.signedRequest)==null?void 0:f.accountId)||"",publicKey:((w=i==null?void 0:i.signedRequest)==null?void 0:w.publicKey)||"",signature:((u=i==null?void 0:i.signedRequest)==null?void 0:u.signature)||""}})}async signAndSendTransactions(e,n){const r=n||window.localStorage.getItem("signedAccountId")||this.signedAccountId,o=await Promise.all(e.map(s=>this.completeTransaction({signerId:r,receiverId:s.receiverId,actions:s.actions})));return this.signAndSendTransactionsMNW(o)}async signAndSendTransaction({signerId:e,receiverId:n,actions:r}){const o=e||window.localStorage.getItem("signedAccountId")||this.signedAccountId,s=this.getKeyForContract(n);if(r.length===1&&s&&this.keyCanSign(s,r))try{return await this.signUsingKeyPair({signerId:o,receiverId:n,actions:r,key:s})}catch(i){console.warn("Failed to sign using key pair, falling back to wallet",i)}const a=await this.completeTransaction({signerId:o,receiverId:n,actions:r});return(await this.signAndSendTransactionsMNW([a]))[0]}async completeTransaction({signerId:e,receiverId:n,actions:r}){const o=e||window.localStorage.getItem("signedAccountId")||this.signedAccountId,s=await this.provider.block({finality:"final"});return{signerId:o,publicKey:Ut(ee()),nonce:0,receiverId:n,blockHash:s.header.hash,actions:r}}async signAndSendTransactionsMNW(e){var o;const n=this.requestSignTransactionsUrl(e),r=(o=await this.handlePopupTransaction(n,s=>s.transactionHashes))==null?void 0:o.split(",");if(!r)throw new Error("No transaction hashes received");return Promise.all(r.map(s=>this.provider.txStatus(s,"unused","NONE")))}getKeyForContract(e){const n=window.localStorage.getItem(`functionCallKey:${e}`);return n?{...JSON.parse(n),contractId:e}:this.functionCallKey&&this.functionCallKey.contractId===e?this.functionCallKey:null}keyCanSign(e,n){const r=n[0];return!!(r.type==="FunctionCall"&&(r.deposit==="0"||r.deposit===void 0)&&(e.methods.length===0||e.methods.includes(r.methodName)))}async signUsingKeyPair({signerId:e,receiverId:n,actions:r,key:o}){const s=e||window.localStorage.getItem("signedAccountId")||this.signedAccountId,a=Ut(o.privateKey),c=await this.provider.query({request_type:"view_access_key",account_id:s,public_key:a,finality:"optimistic"}),i=BigInt(c.nonce)+1n,f=await this.provider.block({finality:"final"}),w={signerId:s,publicKey:a,nonce:i,receiverId:n,blockHash:f.header.hash,actions:r},u=Mt(w),E=Pt(Ht.Transaction,u),K=He(E),R=Ae(K,o.privateKey),B=Pt(Ht.SignedTransaction,{transaction:u,signature:{ed25519Signature:{data:R}}});return this.provider.sendJsonRpc("send_tx",{signed_tx_base64:te(new Uint8Array(B)),wait_until:"EXECUTED_OPTIMISTIC"})}requestSignTransactionsUrl(e){const n=new URL("sign",this.walletUrl);return n.searchParams.set("transactions",e.map(r=>Pt(Ht.Transaction,Mt(r))).map(r=>te(new Uint8Array(r))).join(",")),n.searchParams.set("callbackUrl",new URL(window.selector.location).toString()),n.toString()}async handlePopupTransaction(e,n){const r=Math.round(window.screenX+(window.outerWidth-Mn)/2),o=Math.round(window.screenY+(window.outerHeight-Hn)/2),s=window.selector.open(e,"MyNearWallet",`width=${Mn},height=${Hn},top=${o},left=${r},scrollbars=yes,resizable=yes`);return await s.windowIdPromise?new Promise((c,i)=>{const f=this.setupMessageHandler(c,i,s,n),w=setInterval(()=>{s.closed&&(window.removeEventListener("message",f),clearInterval(w),i(new Error("User closed the window")))},Yo)}):(await window.selector.ui.whenApprove({title:"Request action",button:"Open wallet"}),await this.handlePopupTransaction(e,n))}setupMessageHandler(e,n,r,o){const s=async a=>{const c=a.data;if(!c.method)switch(c.status){case"success":r==null||r.close(),e(o(c));break;case"failure":r==null||r.close(),n(new Error(c.errorMessage||"Transaction failed"));break;default:console.warn("Unhandled message status:",c.status)}};return window.addEventListener("message",s),s}}const G={mainnet:new $n("https://app.mynearwallet.com",{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org",indexerUrl:"https://indexer.mainnet.near.org"}),testnet:new $n("https://testnet.mynearwallet.com",{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",indexerUrl:"https://indexer.testnet.near.org"})};(async()=>{const t=async e=>{const n=G[e].getAccountId(),r=G[e].getPublicKey();return[{accountId:n,publicKey:r}]};return{async signIn({contractId:e,methodNames:n,network:r}){return G[r].isSignedIn()||await G[r].requestSignIn({contractId:e,methodNames:n}),t(r)},async signOut({network:e}){G[e].signOut()},async getAccounts({network:e}){return t(e)},async verifyOwner(){throw new Error("Method not supported by MyNearWallet")},async signMessage({message:e,nonce:n,recipient:r,callbackUrl:o,state:s,network:a}){return await G[a].signMessage({message:e,nonce:n,recipient:r,callbackUrl:o,state:s})},async signAndSendTransaction({signerId:e,receiverId:n,actions:r,network:o}){if(!G[o].isSignedIn())throw new Error("Wallet not signed in");return G[o].signAndSendTransaction({signerId:e,receiverId:n,actions:jn(r)})},async signAndSendTransactions({signerId:e,transactions:n,network:r}){if(!G[r].isSignedIn())throw new Error("Wallet not signed in");return G[r].signAndSendTransactions(n.map(o=>({actions:jn(o.actions),receiverId:o.receiverId})),e)},async generateFunctionCallKey({contractId:e,methodNames:n,network:r}){if(!G[r].isSignedIn())throw new Error("Wallet not signed in");const o=ee(),s=Ut(o);return window.localStorage.setItem(`pendingFunctionCallKey:${s}`,JSON.stringify({privateKey:o,contractId:e,methods:n||[]})),{publicKey:s}},async confirmFunctionCallKey({publicKey:e,network:n}){const r=window.localStorage.getItem(`pendingFunctionCallKey:${e}`);if(!r)throw new Error("No pending function call key found for this public key");const{privateKey:o,contractId:s,methods:a}=JSON.parse(r);window.localStorage.setItem(`functionCallKey:${s}`,JSON.stringify({privateKey:o,methods:a})),G[n].functionCallKey={privateKey:o,contractId:s,methods:a},window.localStorage.removeItem(`pendingFunctionCallKey:${e}`)},async removeFunctionCallKey({publicKey:e}){window.localStorage.removeItem(`pendingFunctionCallKey:${e}`)}}})().then(t=>{window.selector.ready(t)})})();
